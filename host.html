
<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Host - Area Privata</title>
  <style>
    body {
      font-family: monospace;
      background-color: #111;
      color: #fff;
      padding: 20px;
    }
    h2 {
      border-bottom: 1px solid #555;
      padding-bottom: 5px;
    }
    .hidden {
      display: none;
    }
    input, button, select {
      margin: 5px 0;
      padding: 8px;
      font-size: 16px;
    }
    .section {
      margin-top: 30px;
    }
    .list {
      background-color: #222;
      padding: 10px;
      margin-top: 10px;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <h1>HOST - Area Privata</h1>
  <div id="loginSection">
    <p>Inserisci la password per accedere:</p>
    <input type="password" id="passwordInput" />
    <button onclick="checkPassword()">Entra</button>
    <p id="loginError" style="color: red;"></p>
  </div>

  <div id="adminPanel" class="hidden">
    <!-- GIOCATORI -->
    <div class="section">
      <h2>üë• Giocatori</h2>
      <input type="text" id="newPlayer" placeholder="Nome giocatore" />
      <button onclick="addPlayer()">Aggiungi</button>
      <div class="list" id="playerList"></div>
    </div>

    <!-- TASK -->
    <div class="section">
      <h2>üìù Task</h2>
      <input type="text" id="newTask" placeholder="Nuovo task" />
      <button onclick="addTask()">Aggiungi Task</button>
      <div class="list" id="taskList"></div>
    </div>

    <!-- ASSEGNA TASK -->
    <div class="section">
      <h2>üéØ Assegna Task</h2>
      <button onclick="assignTasks()">Assegna task casuali</button>
      <p id="assignMsg"></p>
    </div>

    <!-- PUNTEGGI -->
    <div class="section">
      <h2>üßÆ Assegna Punteggio</h2>
      <select id="playerSelect"></select>
      <select id="pointsSelect">
        <option value="10">+10 Talpa non scoperta</option>
        <option value="5">+5 Chi scopre la talpa</option>
        <option value="2">+2 Collaboratori</option>
        <option value="0">0 Talpa scoperta</option>
        <option value="-2">‚Äì2 Collaboratori scoperti</option>
        <option value="-5">‚Äì5 Accusa sbagliata</option>
      </select>
      <button onclick="addPoints()">Assegna</button>
    </div>

    <!-- RESET -->
    <div class="section">
      <h2>‚ôªÔ∏è Reset Giornata</h2>
      <button onclick="resetDay()">Resetta giornata</button>
    </div>
  </div>

  <script>
    const PASSWORDS = ["Cardio89!", "Neuro76!"];

    function checkPassword() {
      const input = document.getElementById('passwordInput').value;
      if (PASSWORDS.includes(input)) {
        document.getElementById('loginSection').classList.add('hidden');
        document.getElementById('adminPanel').classList.remove('hidden');
        renderAll();
      } else {
        document.getElementById('loginError').innerText = "Password errata.";
      }
    }

    function get(key) {
      return JSON.parse(localStorage.getItem(key) || '[]');
    }

    function set(key, value) {
      localStorage.setItem(key, JSON.stringify(value));
    }

    function renderAll() {
      const players = get('players');
      const tasks = get('tasks');
      const scores = get('scores') || {};
      const playerList = document.getElementById('playerList');
      const taskList = document.getElementById('taskList');
      const playerSelect = document.getElementById('playerSelect');

      playerList.innerHTML = players.map(p => \`\${p} <button onclick="removePlayer('\${p}')">‚ùå</button>\`).join('<br>');
      taskList.innerHTML = tasks.map((t, i) => \`\${t} <button onclick="removeTask(\${i})">üóëÔ∏è</button>\`).join('<br>');

      playerSelect.innerHTML = players.map(p => \`<option value="\${p}">\${p}</option>\`).join('');
    }

    function addPlayer() {
      const name = document.getElementById('newPlayer').value.trim();
      if (!name) return;
      const players = get('players');
      if (!players.includes(name)) {
        players.push(name);
        set('players', players);
        renderAll();
      }
    }

    function removePlayer(name) {
      const players = get('players').filter(p => p !== name);
      set('players', players);
      renderAll();
    }

    function addTask() {
      const task = document.getElementById('newTask').value.trim();
      if (!task) return;
      const tasks = get('tasks');
      tasks.push(task);
      set('tasks', tasks);
      renderAll();
    }

    function removeTask(index) {
      const tasks = get('tasks');
      tasks.splice(index, 1);
      set('tasks', tasks);
      renderAll();
    }

    function assignTasks() {
      const players = get('players');
      let tasks = get('tasks').slice(); // copia
      const assigned = {};
      players.forEach(p => {
        if (tasks.length === 0) return;
        const idx = Math.floor(Math.random() * tasks.length);
        assigned[p] = tasks[idx];
        tasks.splice(idx, 1);
      });
      localStorage.setItem('taskAssignments', JSON.stringify(assigned));
      document.getElementById('assignMsg').innerText = "Task assegnati!";
    }

    function addPoints() {
      const player = document.getElementById('playerSelect').value;
      const points = parseInt(document.getElementById('pointsSelect').value);
      const scores = JSON.parse(localStorage.getItem('scores') || '{}');
      scores[player] = (scores[player] || 0) + points;
      localStorage.setItem('scores', JSON.stringify(scores));
      alert("Punteggio aggiornato per " + player);
    }

    function resetDay() {
      localStorage.removeItem('taskAssignments');
      document.getElementById('assignMsg').innerText = "Giornata resettata. Task azzerati.";
    }
  </script>
</body>
</html>
