
<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Area Host (Debug)</title>
  <style>
    body {
      background-color: #111;
      color: #fff;
      font-family: monospace;
      padding: 20px;
    }
    h1 {
      text-align: center;
    }
    input, button, select, textarea {
      font-size: 16px;
      padding: 10px;
      margin: 5px 0;
      width: 100%;
      box-sizing: border-box;
    }
    .section {
      margin: 20px 0;
      padding: 15px;
      background-color: #222;
      border-radius: 8px;
    }
    label {
      font-weight: bold;
      margin-top: 10px;
      display: block;
    }
    .log-box {
      margin-top: 10px;
      padding: 10px;
      background-color: #333;
      font-size: 14px;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h1>üîê Area Host (Debug)</h1>

  <div id="loginSection">
    <p>Inserisci la password per accedere:</p>
    <input type="password" id="hostPassword" placeholder="Password" />
    <button onclick="checkHost()">Entra</button>
    <p id="loginError" style="color: red;"></p>
  </div>

  <div id="hostPanel" style="display:none;">
    <div class="section">
      <h2>üë• Giocatori</h2>
      <input type="text" id="newPlayer" placeholder="Nuovo giocatore" />
      <button onclick="addPlayer()">Aggiungi</button>
      <ul id="playerList"></ul>
    </div>

    <div class="section">
      <h2>üìù Task</h2>
      <textarea id="newTask" placeholder="Nuovo task..."></textarea>
      <button onclick="addTask()">Aggiungi Task</button>
      <ul id="taskList"></ul>
    </div>

    <div class="section">
      <h2>üéØ Assegna Task Casuali</h2>
      <button onclick="assignTasks()">Assegna</button>
      <div class="log-box" id="assignLog"></div>
    </div>

    <div class="section">
      <h2>üßÆ Assegna Punteggio</h2>
      <select id="scorePlayer"></select>
      <select id="scoreValue">
        <option value="10">+10 (Talpa non scoperta)</option>
        <option value="5">+5 (Chi scopre la talpa)</option>
        <option value="2">+2 (Collaboratori)</option>
        <option value="0">0 (Talpa scoperta)</option>
        <option value="-2">-2 (Collaboratori scoperti)</option>
        <option value="-5">-5 (Accusa sbagliata)</option>
      </select>
      <button onclick="assignScore()">Assegna Punti</button>
    </div>

    <div class="section">
      <h2>‚ôªÔ∏è Reset Giornata</h2>
      <button onclick="resetDay()">Reset</button>
    </div>
  </div>

  <script>
    const HOST_PASSWORD = "Pneumo98!";

    function checkHost() {
      const pw = document.getElementById("hostPassword").value;
      if (pw === HOST_PASSWORD) {
        document.getElementById("loginSection").style.display = "none";
        document.getElementById("hostPanel").style.display = "block";
        renderAll();
      } else {
        document.getElementById("loginError").innerText = "Password errata.";
      }
    }

    function getData(key) {
      return JSON.parse(localStorage.getItem(key) || "[]");
    }
    function setData(key, value) {
      localStorage.setItem(key, JSON.stringify(value));
    }

    function addPlayer() {
      const name = document.getElementById("newPlayer").value.trim();
      if (!name) return;
      const players = getData("players");
      if (!players.includes(name)) {
        players.push(name);
        setData("players", players);
        document.getElementById("newPlayer").value = "";
        renderPlayers();
      }
    }

    function addTask() {
      const task = document.getElementById("newTask").value.trim();
      if (!task) return;
      const tasks = getData("tasks");
      tasks.push(task);
      setData("tasks", tasks);
      document.getElementById("newTask").value = "";
      renderTasks();
    }

    function renderPlayers() {
      const players = getData("players");
      const list = document.getElementById("playerList");
      const select = document.getElementById("scorePlayer");
      list.innerHTML = "";
      select.innerHTML = "";
      players.forEach(p => {
        const li = document.createElement("li");
        li.innerText = p;
        list.appendChild(li);
        const option = document.createElement("option");
        option.value = p;
        option.innerText = p;
        select.appendChild(option);
      });
    }

    function renderTasks() {
      const tasks = getData("tasks");
      const list = document.getElementById("taskList");
      list.innerHTML = "";
      tasks.forEach(t => {
        const li = document.createElement("li");
        li.innerText = t;
        list.appendChild(li);
      });
    }

    function assignTasks() {
      const players = getData("players");
      let tasks = getData("tasks").slice();
      const assignments = {};
      const log = [];

      if (players.length === 0 || tasks.length === 0) {
        document.getElementById("assignLog").innerText = "‚ö†Ô∏è Aggiungi prima giocatori e task.";
        return;
      }

      players.forEach(p => {
        if (tasks.length === 0) {
          log.push(`‚ùå Nessun task rimanente per ${p}`);
        } else {
          const index = Math.floor(Math.random() * tasks.length);
          assignments[p] = tasks[index];
          log.push(`‚úÖ ${p} ha ricevuto un task.`);
          tasks.splice(index, 1);
        }
      });

      localStorage.setItem("taskAssignments", JSON.stringify(assignments));
      document.getElementById("assignLog").innerText = log.join("\n");
      console.log("üì¶ Assegnazioni salvate:", assignments);
    }

    function assignScore() {
      const player = document.getElementById("scorePlayer").value;
      const score = parseInt(document.getElementById("scoreValue").value);
      const scores = JSON.parse(localStorage.getItem("scores") || "{}");
      scores[player] = (scores[player] || 0) + score;
      localStorage.setItem("scores", JSON.stringify(scores));
      alert("Punteggio aggiornato.");
    }

    function resetDay() {
      localStorage.removeItem("taskAssignments");
      localStorage.removeItem("swapQueue");
      alert("Giornata resettata!");
    }

    function renderAll() {
      renderPlayers();
      renderTasks();
    }
  </script>
</body>
</html>
